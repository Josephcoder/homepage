{"version":3,"sources":["containers/Claimings/Admin/ClaimReport.tsx"],"names":["_ClaimReport","props","setLoading","status","setState","loading","GetClaims","level","session_id","a","axios","post","API","CLAIMING","period_id","res","data","console","log","GetSummaryFilter","response","item","test","find","itm","position_title","undefined","filter","push","total","pending","ClaimStatus","PENDING","validated","EVALUATED","GetSummary","res_data","type_key","PlansTypeKeys","APPLICATION","title","claims","claim_status","sort","b","GetSummaryCounts","componentDidMount","schoolLevels","selectedEducationCategory","education_categories","education_institute_id","auth","education_institution_id","setSelectedEducationCategory","session_plan","state","selected_level","_id","error","success","selected_claim_type","this","className","onChange","e","target","value","DOCUMENT_VALIDATION","EXAMINATION","displayNumbers","length","colSpan","map","i","Component","ClaimReport","connect","system","positions","loadAllPositionsByInstitute"],"mappings":"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","file":"static/js/55.8dbc782b.chunk.js","sourcesContent":["import axios from \"axios\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport {\n  Auth,\n  positionsStoreInterface,\n  schoolLevelsStoreInterface,\n  System,\n  setSelectedEducationCategory,\n  loadAllPositionsByInstitute,\n} from \"../../../actions\";\nimport Loading from \"../../../components/Loading/Loading\";\nimport {\n  ClaimStatus,\n  education_category,\n  PlansTypeKeys,\n} from \"../../../interfaces\";\nimport { StoreState } from \"../../../reducers\";\nimport { API } from \"../../../utils/api\";\nimport { displayNumbers } from \"../../../utils/functions\";\n\ninterface GetClaimsReportInterface {\n  _id: string;\n  previous: {\n    evaluater: {\n      email: string;\n      name: string;\n    };\n    reason: string;\n    status: string;\n  };\n  title: string;\n  last_claim_status: ClaimStatus;\n  claiming_on_id: string;\n  type_key: PlansTypeKeys;\n  default_claim_resaons: string;\n  user: string;\n  period_id: string;\n  claim_level: number;\n  claims: [\n    {\n      claim_status: ClaimStatus;\n      _id: string;\n      level: number;\n      reason: string;\n      date_created: string;\n      createdAt: string;\n      updatedAt: string;\n    }\n  ];\n  createdAt: string;\n  updatedAt: string;\n  __v: 0;\n}\n\ninterface PositionSummaryInterface {\n  position_title: string;\n  total: number;\n  status: ClaimStatus;\n}\n\ninterface ClaimReportProps {\n  auth: Auth;\n  system: System;\n  positions: positionsStoreInterface;\n  schoolLevels: schoolLevelsStoreInterface;\n  setSelectedEducationCategory: (data: education_category) => void;\n  loadAllPositionsByInstitute: (\n    institution_id: string,\n    callback: (loading: boolean) => void\n  ) => void;\n}\ninterface ClaimReportState {\n  error: string;\n  success: string;\n  loading: boolean;\n  data: GetClaimsReportInterface[] | null;\n  selected_level: number;\n  selected_claim_type: PlansTypeKeys;\n}\n\nclass _ClaimReport extends Component<ClaimReportProps, ClaimReportState> {\n  constructor(props: ClaimReportProps) {\n    super(props);\n\n    this.state = {\n      loading: true,\n      error: \"\",\n      success: \"\",\n      data: null,\n      selected_level: 1,\n      selected_claim_type: PlansTypeKeys.APPLICATION,\n    };\n  }\n  setLoading = (status: boolean) => this.setState({ loading: status });\n  GetClaims = async (level: number, session_id: string) => {\n    this.setLoading(true);\n    try {\n      const res = await axios.post<GetClaimsReportInterface[]>(\n        `${API.CLAIMING}/user/level/${level}`,\n        {\n          period_id: session_id,\n        }\n      );\n      if (res.data) {\n        this.setState({\n          data: res.data,\n        });\n      }\n      console.log(\"Response: \", res.data);\n      this.setLoading(false);\n    } catch (error: any) {\n      console.log(\"Error: \", { ...error });\n      this.setLoading(false);\n    }\n  };\n\n  GetSummaryFilter = (data: PositionSummaryInterface[]) => {\n    let response: {\n      position_title: string;\n      total: number;\n      pending: number;\n      validated: number;\n    }[] = [];\n    for (const item of data) {\n      const test = response.find(\n        (itm) => itm.position_title === item.position_title\n      );\n      if (test !== undefined) {\n        response = response.filter(\n          (itm) => itm.position_title !== test.position_title\n        );\n        response.push({\n          position_title: test.position_title,\n          total: test.total + 1,\n          pending:\n            item.status === ClaimStatus.PENDING\n              ? test.pending + 1\n              : test.pending,\n          validated:\n            item.status === ClaimStatus.EVALUATED\n              ? test.validated + 1\n              : test.validated,\n        });\n      } else {\n        response.push({\n          position_title: item.position_title,\n          total: item.total,\n          pending: item.status === ClaimStatus.PENDING ? 1 : 0,\n          validated: item.status === ClaimStatus.EVALUATED ? 1 : 0,\n        });\n      }\n    }\n    return response;\n  };\n\n  GetSummary = (\n    data: GetClaimsReportInterface[]\n  ): {\n    position_title: string;\n    total: number;\n    pending: number;\n    validated: number;\n  }[] => {\n    let response: PositionSummaryInterface[] = [];\n    const res_data = data.filter(\n      (itm) => itm.type_key === PlansTypeKeys.APPLICATION\n    );\n    for (const item of res_data) {\n      response.push({\n        position_title: item.title,\n        total: 1,\n        status: item.claims.filter((itm) => itm.level === 1)[0].claim_status,\n      });\n    }\n    return this.GetSummaryFilter(response).sort((a, b) =>\n      a.pending < b.pending ? 1 : b.pending < a.pending ? -1 : 0\n    );\n  };\n\n  GetSummaryCounts = (\n    data: {\n      position_title: string;\n      total: number;\n      pending: number;\n      validated: number;\n    }[]\n  ): {\n    pending: number;\n    validated: number;\n    total: number;\n  } => {\n    let res: {\n      pending: number;\n      validated: number;\n      total: number;\n    } = {\n      pending: 0,\n      validated: 0,\n      total: 0,\n    };\n    let pending: number = 0;\n    let validated: number = 0;\n    let total: number = 0;\n    for (const item of data) {\n      pending = pending + item.pending;\n      validated = validated + item.validated;\n      total = total + item.total;\n    }\n    res = {\n      pending: pending,\n      validated: validated,\n      total: total,\n    };\n    return res;\n  };\n\n  componentDidMount = () => {\n    if (this.props.schoolLevels.selectedEducationCategory === null) {\n      if (this.props.schoolLevels.education_categories !== null) {\n        const test = this.props.schoolLevels.education_categories.find(\n          (itm) =>\n            itm.education_institute_id ===\n            this.props.auth.education_institution_id\n        );\n        if (test !== undefined) {\n          this.props.setSelectedEducationCategory(test);\n          if (test.session_plan !== null) {\n            this.GetClaims(this.state.selected_level, test.session_plan._id);\n          }\n        }\n      }\n    } else {\n      if (\n        this.props.schoolLevels.selectedEducationCategory.session_plan !== null\n      ) {\n        this.GetClaims(\n          this.state.selected_level,\n          this.props.schoolLevels.selectedEducationCategory.session_plan._id\n        );\n      }\n    }\n  };\n  render() {\n    const selected_institution =\n      this.props.schoolLevels.education_categories?.find(\n        (itm) =>\n          itm.education_institute_id ===\n          this.props.auth.education_institution_id\n      );\n    if (selected_institution === undefined) {\n      return (\n        <div>\n          <div className=\"rounded-xl border-2 border-gray-600 flex flex-col items-center justify-center p-7 text-center w-full mt-5 bg-white\">\n            <span className=\"font-extrabold text-3xl text-gray-600\">\n              Your institute is not yet defined\n            </span>\n            <span>\n              If you have an institute assigned to you, please refresh your page\n              or wait a moment... your page...\n              {/* You are not allowed to view shortlisting report because you have\n              no access for this report. please contact your administrator */}\n            </span>\n          </div>\n        </div>\n      );\n    }\n    if (\n      this.state.loading === null ||\n      this.props.schoolLevels.selectedEducationCategory === null ||\n      this.state.data === null\n    ) {\n      return (\n        <div className=\"bg-white rounded p-5 mt-5\">\n          <Loading />\n          <div className=\"-mt-5 ml-5\">Loading report, please wait...</div>\n        </div>\n      );\n    }\n    if (this.state.error !== \"\") {\n      <div onClick={() => this.setState({ error: \"\" })}>\n        <div className=\"cursor-pointer rounded-xl border-2 border-yellow-600 flex flex-col items-center justify-center p-7 text-center w-full mt-5 bg-yellow-100\">\n          <span className=\"font-extrabold text-3xl text-yellow-800\">\n            Error occurred!\n          </span>\n          <span>{this.state.error}</span>\n        </div>\n      </div>;\n    }\n    return (\n      <div>\n        <div className=\"mt-4 bg-white rounded\">\n          <div className=\"p-4 flex flex-row items-center gap-3 justify-between\">\n            <div>\n              <div className=\"text-3xl font-extrabold\">Claiming report</div>\n              <div className=\"flex flex-row items-center gap-2 ml-2\">\n                <div className=\"flex flex-col\">\n                  <span className=\"text-sm font-bold\">Choose claim type</span>\n                  <select\n                    onChange={(e) =>\n                      this.setState({\n                        selected_claim_type: e.target.value as PlansTypeKeys,\n                      })\n                    }\n                    value={this.state.selected_claim_type}\n                    className=\"px-3 py-2 rounded border border-gray-400\"\n                  >\n                    <option value={PlansTypeKeys.APPLICATION}>\n                      Applications\n                    </option>\n                    <option value={PlansTypeKeys.DOCUMENT_VALIDATION}>\n                      Document validation\n                    </option>\n                    <option value={PlansTypeKeys.EXAMINATION}>\n                      Examinations\n                    </option>\n                  </select>\n                </div>\n                <div className=\"flex flex-col\">\n                  <span className=\"text-sm font-bold\">Choose claim level</span>\n                  <select className=\"px-3 py-2 rounded border border-gray-400\">\n                    <option>Choose claim level</option>\n                  </select>\n                </div>\n              </div>\n            </div>\n            <div className=\"flex flex-row items-center gap-3\">\n              <div className=\"flex flex-col rounded bg-gray-200 p-2 text-right\">\n                <span className=\"text-3xl font-extrabold\">\n                  {displayNumbers(\n                    this.GetSummaryCounts(this.GetSummary(this.state.data))\n                      .total\n                  )}\n                </span>\n                <span className=\"font-bold text-gray-500\">Total claims</span>\n              </div>\n              <div className=\"flex flex-col rounded bg-gray-200 p-2 text-right\">\n                <span className=\"text-3xl font-extrabold\">\n                  {displayNumbers(\n                    this.GetSummaryCounts(this.GetSummary(this.state.data))\n                      .pending\n                  )}\n                </span>\n                <span className=\"font-bold text-gray-500\">Waiting claims</span>\n              </div>\n              <div className=\"flex flex-col rounded bg-gray-200 p-2 text-right\">\n                <span className=\"text-3xl font-extrabold\">\n                  {displayNumbers(\n                    this.GetSummaryCounts(this.GetSummary(this.state.data))\n                      .validated\n                  )}\n                </span>\n                <span className=\"font-bold text-gray-500\">\n                  Validated claims\n                </span>\n              </div>\n            </div>\n          </div>\n          <div className=\"border-t border-gray-400 p-4\">\n            <table className=\"w-full\">\n              <thead className=\"bg-blue-100 \">\n                <tr className=\"\">\n                  <th className=\"px-3 py-1 text-center\">#</th>\n                  <th className=\"px-3 py-1 text-left\">Position</th>\n                  <th className=\"px-3 py-1 text-center\">Total claims</th>\n                  <th className=\"px-3 py-1 text-center\">Waiting claims</th>\n                  <th className=\"px-3 py-1 text-center\">Validated claims</th>\n                </tr>\n              </thead>\n              <tbody>\n                {this.GetSummary(this.state.data).length === 0 ? (\n                  <tr>\n                    <td\n                      colSpan={5}\n                      className=\"text-center p-3 text-3xl font-light bg-gray-100 border border-gray-500 rounded\"\n                    >\n                      No result found!\n                    </td>\n                  </tr>\n                ) : (\n                  this.GetSummary(this.state.data).map((item, i) => (\n                    <tr\n                      key={i + 1}\n                      className={`${i % 2 !== 0 ? \"bg-gray-100\" : \"bg-white\"} ${\n                        item.total === item.validated\n                          ? \"text-green-900 font-light\"\n                          : item.validated === 0\n                          ? \"text-yellow-900 font-bold\"\n                          : \"text-black font-light\"\n                      }`}\n                    >\n                      <td className=\"px-3 py-1 text-center\">{i + 1}</td>\n                      <td className=\"px-3 py-1 text-left\">\n                        {item.position_title}\n                      </td>\n                      <td className=\"px-3 py-1 text-center\">\n                        {displayNumbers(item.total)}\n                      </td>\n                      <td className=\"px-3 py-1 text-center\">\n                        {displayNumbers(item.pending)}\n                      </td>\n                      <td className=\"px-3 py-1 text-center\">\n                        {displayNumbers(item.validated)}\n                      </td>\n                    </tr>\n                  ))\n                )}\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = ({\n  auth,\n  system,\n  positions,\n  schoolLevels,\n}: StoreState): {\n  auth: Auth;\n  system: System;\n  positions: positionsStoreInterface;\n  schoolLevels: schoolLevelsStoreInterface;\n} => {\n  return {\n    auth: auth,\n    system: system,\n    positions: positions,\n    schoolLevels,\n  };\n};\n\nexport const ClaimReport = connect(mapStateToProps, {\n  setSelectedEducationCategory,\n  loadAllPositionsByInstitute,\n})(_ClaimReport);\n"],"sourceRoot":""}