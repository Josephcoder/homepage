(this["webpackJsonpreact-redux-typescript-advance"]=this["webpackJsonpreact-redux-typescript-advance"]||[]).push([[71],{1307:function(e,t,s){"use strict";s.r(t),s.d(t,"UserManagement",(function(){return T}));var a=s(2),n=s(5),r=s.n(n),c=s(7),i=s(25),o=s(24),l=s(27),d=s(26),u=s(4),h=s(77),m=s(12),g=s(23),b=s(37),p=s(3),x=s(691),f=s(21),j=s(32),O=s(83),v=s(28),y=s(723),U=s(10),R=s.n(U),_=s(9),N=s(737),w=s(724),A=s(161),L=s(1),q=function(e){Object(l.a)(s,e);var t=Object(d.a)(s);function s(e){var n;return Object(i.a)(this,s),(n=t.call(this,e)).setLoading=function(e){n.setState({loading:e})},n.setManageUser=function(e){n.setState({manageUser:e})},n.setChangeRole=function(e){n.setState({changeRole:e})},n.setManageUserId=function(e){n.setState({manageUserId:e})},n.setLoadingRequest=function(e){n.setState({loadingRequest:e})},n.setLoadingRequestType=function(e){n.setState({loadingRequestType:e})},n.setUserAccess=function(e){n.setState({userAccess:e})},n.setCurrentAccess=function(e){n.setState({currentAccess:e})},n.setRoomList=function(e){n.setState({roomList:e})},n.setRoomTables=function(e){n.setState({roomTable:e})},n.componentDidMount=function(){!0===Object(p.g)(n.props.auth,O.a.USER_MANAGEMENT).view&&(0===n.props.accessRoles.length&&n.props.FC_GetAccessRoles((function(e,t,s){n.setState({loading:e})})),null===n.props.schoolLevels.education_categories||0===n.props.schoolLevels.education_categories.length?n.props.loadEducationCategories((function(e){n.setLoading(e)})):n.setLoading(!1))},n.FC_GetRoleById=function(e,t){return e.find((function(e){return e.system_user_role_id===t}))},n.FC_DoSearch=function(e){if(e.preventDefault(),Object(j.f)(n.state.searchFind))return n.setState({searchError:"Required!"});Object(x.a)(n.state.searchFind,(function(e,t,s){n.setState({searchLoading:e}),!1===e&&(Object(j.f)(t)?null===s||""===s?n.props.PushPopupAlert({title:"User not found!",theme:f.a.warning}):(console.log("===================--------================="),console.log(s),console.log("===================--------================="),n.setManageUser(s),n.setManageUserId(s.user_id)):n.props.PushPopupAlert({title:t,theme:f.a.danger}))}))},n.FC_RestUserAccess=function(){var e=Object(c.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||n.props.PushPopupAlert({title:"User Access is required doesn't exist",theme:f.a.warning}),window.confirm("Are sure you want to reset to default access?")){e.next=3;break}return e.abrupt("return",n.setLoadingRequest(!1));case 3:return n.setLoadingRequest(!0),n.setLoadingRequestType("RESET"),e.prev=5,e.next=8,R.a.delete("".concat(_.a.USER,"/access/custom/user/").concat(t));case 8:e.sent&&n.state.manageUser&&(n.state.manageUser.default_access&&n.setUserAccess(n.state.manageUser.default_access.access),n.props.PushPopupAlert({title:"Resetting User Access complete successfully",theme:f.a.info}),n.setCurrentAccess(null)),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(5),console.error({reseting_user_access:e.t0}),n.props.PushPopupAlert({title:Object(v.i)(e.t0),theme:f.a.danger});case 16:n.setLoadingRequest(!1),n.setLoadingRequestType(null),t="";case 19:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(t){return e.apply(this,arguments)}}(),n.FC_BlockUser=function(){var e=Object(c.a)(r.a.mark((function e(t,s){var c,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||n.props.PushPopupAlert({title:"User Access is required doesn't exist",theme:f.a.danger}),n.setLoadingRequest(!0),window.confirm("Are sure you want to ".concat(s?"block":"activate"," this user?"))){e.next=4;break}return e.abrupt("return",n.setLoadingRequest(!1));case 4:return e.prev=4,e.next=7,R.a.patch("".concat(_.a.AUTH,"/auth/user/disactive/").concat(t),{is_active:!s});case 7:(c=e.sent)&&(console.log("===================================="),console.log({blockUserToSystem:c}),console.log("===================================="),(i=Object(a.a)({},n.state.manageUser)).is_active=!s,n.setManageUser(i),n.props.PushPopupAlert({title:"User has been ".concat(s?"blocked":"activated","!"),theme:f.a.info})),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(4),console.error({blockUser_ERROR:e.t0}),n.props.PushPopupAlert({title:Object(v.i)(e.t0),theme:f.a.danger});case 15:n.setLoadingRequest(!1),t="";case 17:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t,s){return e.apply(this,arguments)}}(),n.FC_DistinctDistrict=function(e,t){var s=[],a=[];if(t)a=e.find((function(e){return e._id===t}))&&e.find((function(e){return e._id===t})).districts?e.find((function(e){return e._id===t})).districts:[];else for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n))for(var r in e[n].districts)Object.prototype.hasOwnProperty.call(e[n].districts,r)&&(s.includes(e[n].districts[r]._id)||(s.push(e[n].districts[r]._id),a.push(e[n].districts[r])));return a},n.state={loading:!0,manageUser:null,searchLoading:!1,searchFind:"",changeRole:!1,searchError:"",manageUserId:"",loadingRequestType:null,loadingRequest:!1,userAccess:null,currentAccess:null,roomList:null,roomTable:null},n}return Object(o.a)(s,[{key:"render",value:function(){var e=this;if(!1===Object(p.g)(this.props.auth,O.a.USER_MANAGEMENT).view)return Object(L.jsx)(b.a,{to:"/apps-page"});if(!0===this.state.loading)return Object(L.jsx)("div",{className:"text-center mt-7 font-bold text-4xl text-gray-400 animate-pulse",children:"Loading..."});var t=this.state.roomList?this.FC_DistinctDistrict(this.state.roomList):[],s=this.state.manageUser&&this.state.manageUser.default_access?this.FC_GetRoleById(this.props.accessRoles,this.state.manageUser.default_access.system_user_role_id):void 0,a=this.state.roomTable&&this.state.manageUser?this.state.roomTable.find((function(t){var s;return t.room_id===(null===(s=e.state.manageUser.default_access)||void 0===s?void 0:s.room_id)})):void 0,n=this.state.manageUser&&this.props.schoolLevels.education_categories?Object(j.c)(this.props.schoolLevels.education_categories,this.state.manageUser.default_access.education_institution_id):void 0;return Object(L.jsxs)("div",{className:"mb-4",children:[Object(L.jsx)("div",{className:"mt-3 rounded flex flex-row justify-between items-center",children:Object(L.jsxs)("div",{className:"flex flex-row items-center gap-3",children:[Object(L.jsx)(m.Vb,{className:"text-6xl text-blue-600"}),Object(L.jsx)("div",{className:"flex flex-col",children:Object(L.jsx)("span",{className:"text-blue-600 text-2xl font-bold",children:"User Management"})})]})}),Object(L.jsxs)("div",{className:"bg-white shadow rounded border border-gray-2 p-2 w-full overflow-x-auto ".concat(this.state.manageUser?"mt-3":""),children:[Object(L.jsx)("section",{className:"flex flex-col sm:flex-row justify-between items-center gap-2",children:Object(L.jsxs)("section",{children:[Object(L.jsx)("form",{onSubmit:this.FC_DoSearch,className:"w-full mt-8 bg-transparent border-2 rounded-md lg:max-w-sm ".concat(Object(j.f)(this.state.searchError)?"border-gray-500 dark:border-gray-700 focus-within:border-gray-400 dark:focus-within:border-gray-400":"border-red-500 dark:border-red-700 focus-within:border-red-400 dark:focus-within:border-red-400"),children:Object(L.jsxs)("div",{className:"flex flex-col lg:flex-row",children:[Object(L.jsx)("input",{type:"text",placeholder:"Search by NID or Phone or Email",className:"flex-1 h-10 px-4 py-2 m-1 text-gray-700 placeholder-gray-400 bg-transparent border-none appearance-none dark:text-gray-200 focus:outline-none focus:placeholder-transparent focus:ring-0",disabled:this.state.searchLoading||this.state.loading,onChange:function(t){return e.setState({searchFind:t.target.value,searchError:""})}}),Object(L.jsx)("button",{type:"submit",className:"h-10 px-4 py-2 m-1 text-sm text-white transition-colors duration-200 transform bg-gray-500 rounded-md hover:bg-gray-400 focus:outline-none focus:bg-gray-400",disabled:this.state.searchLoading||this.state.loading,children:this.state.searchLoading?"Loading":"Search"})]})}),!Object(j.f)(this.state.searchError)&&Object(L.jsx)("span",{className:"text-red-500",children:this.state.searchError})]})}),this.state.manageUser&&Object(L.jsxs)("div",{className:"flex items-center gap-3 mb-2 text-gray-600",children:[Object(L.jsx)("button",{className:"inline-block p-3 transition rounded-full bg-gray-400 ripple hover:bg-gray-600 focus:outline-none",onClick:function(){e.setManageUser(null),e.setChangeRole(!1),e.setState({searchFind:"",searchError:""})},children:Object(L.jsx)(h.f,{className:"w-6 h-6 text-gray-50"})}),Object(L.jsxs)("div",{className:"flex flex-col hidden",children:[Object(L.jsx)("span",{className:"text-gray-800 font-semibold text-2xl",children:this.state.manageUser.user_info.fname+" "+this.state.manageUser.user_info.lname}),Object(L.jsx)("span",{className:"text-gray-600 font-normal text-sm",children:this.state.manageUser.email})]})]}),this.state.manageUser?Object(L.jsxs)("div",{className:"bg-gray-100 h-100",children:[Object(L.jsxs)("div",{className:"bg-white border-b border-t px-4 py-2 flex flex-col md:flex-row items-center gap-x-14",children:[Object(L.jsxs)("div",{className:"flex flex-col md:flex-row md:items-start items-center w-full gap-3",children:[Object(L.jsx)("img",{src:"pic"!==this.state.manageUser.user_info.photo&&void 0!==this.state.manageUser.user_info.photo?Object(v.c)(this.state.manageUser.user_info.photo):y.a,alt:"",className:"rounded-full w-32 h-32 object-contain"}),Object(L.jsxs)("div",{className:"flex flex-col gap-1 items-start w-full",children:[Object(L.jsx)("span",{className:"text-2xl font-semibold",children:this.state.manageUser.user_info.fname+" "+this.state.manageUser.user_info.lname}),Object(L.jsxs)("div",{className:"flex items-center",children:[Object(L.jsx)(m.ab,{className:"w-5 h-5"}),Object(L.jsx)("span",{className:"text-lg font-medium",children:s&&s.role})]}),Object(L.jsxs)("div",{className:"flex items-center gap-1",children:[Object(L.jsx)("span",{className:"text-gray-500",children:"Level:"}),Object(L.jsx)("span",{className:"text-base font-medium",children:s&&s.room_required?"Room":s&&s.education_institution_required?"Institute":"-"})]}),s&&s.education_institution_required?Object(L.jsxs)("div",{className:"flex items-center gap-1",children:[Object(L.jsx)("span",{className:"text-gray-500",children:"Institute:"}),Object(L.jsx)("span",{className:"text-base font-medium",children:this.state.manageUser.default_access&&this.props.schoolLevels.education_categories&&n?n.education_category_title:"Unknown Institute"})]}):s&&s.room_required&&Object(L.jsxs)("div",{className:"flex items-center gap-1",children:[Object(L.jsx)(m.Z,{className:"text-gray-500"}),a&&Object(L.jsx)("span",{className:"text-base font-medium",children:(null===a||void 0===a?void 0:a.district_name)+" - "+(null===a||void 0===a?void 0:a.center_name)+" - Room "+(null===a||void 0===a?void 0:a.room_name)})]})]})]},this.state.manageUser.user_id+Math.random()),Object(L.jsxs)("div",{className:"flex flex-col w-full",children:[Object(L.jsxs)("div",{className:"flex items-center gap-1",children:[Object(L.jsx)("span",{className:"text-gray-500",children:"NID:"}),Object(L.jsx)("span",{className:"text-base font-medium",children:this.state.manageUser.n_id})]}),Object(L.jsxs)("div",{className:"flex items-center gap-1",children:[Object(L.jsx)("span",{className:"text-gray-500",children:"Email:"}),Object(L.jsx)("span",{className:"text-base font-medium",children:this.state.manageUser.email})]}),Object(L.jsxs)("div",{className:"flex items-center gap-1",children:[Object(L.jsx)("span",{className:"text-gray-500",children:"Phone:"}),Object(L.jsx)("span",{className:"text-base font-medium",children:this.state.manageUser.phone_number})]}),Object(L.jsxs)("div",{className:"flex items-center gap-1",children:[Object(L.jsx)("span",{className:"text-gray-500",children:"Status:"}),Object(L.jsx)("span",{className:"text-base font-medium",children:!1===this.state.manageUser.is_active?"Blocked":"Active"})]}),Object(L.jsxs)("div",{className:"flex items-center gap-1",children:[this.state.manageUser.custome_access&&Object(L.jsxs)("button",{className:"px-2 py-1 font-semibold text-gray-50 inline-flex items-center rounded ".concat(this.state.loadingRequestType&&"RESET"===this.state.loadingRequestType?"cursor-wait bg-gray-400":"bg-gray-600"),onClick:function(){return e.FC_RestUserAccess(e.state.manageUser.user_id)},disabled:this.state.loadingRequest,children:[Object(L.jsx)(m.ab,{className:"w-4 h-4 fill-current"}),Object(L.jsx)("span",{children:this.state.loadingRequestType&&"RESET"===this.state.loadingRequestType?"Resetting...":"Reset Access"})]}),!this.state.changeRole&&Object(L.jsxs)("button",{className:"bg-yellow-300 hover:bg-yellow-400 px-2 py-1 font-semibold text-black inline-flex items-center rounded",onClick:function(){return e.setChangeRole(!0)},children:[Object(L.jsx)(m.ab,{className:"w-4 h-4 fill-current"}),Object(L.jsx)("span",{children:"Change Role"})]}),this.state.manageUser.is_active?Object(L.jsxs)("button",{className:"px-2 py-1 font-semibold text-gray-100 inline-flex items-center rounded ".concat(this.state.loadingRequestType&&"STATUS"===this.state.loadingRequestType?"cursor-wait bg-red-500":"bg-red-700"),onClick:function(){return!e.state.loadingRequest&&e.state.manageUser&&e.FC_BlockUser(e.state.manageUser.user_id,e.state.manageUser.is_active)},disabled:this.state.loadingRequest,children:[Object(L.jsx)(m.ab,{className:"w-4 h-4 fill-current"}),Object(L.jsx)("span",{children:this.state.loadingRequestType&&"RESET"===this.state.loadingRequestType?"Loading...":"Block user"})]}):Object(L.jsxs)("button",{className:"px-2 py-1 font-semibold text-gray-100 inline-flex items-center rounded ".concat(this.state.loadingRequestType&&"STATUS"===this.state.loadingRequestType?"cursor-wait bg-yellow-500":"bg-yellow-700"),onClick:function(){return!e.state.loadingRequest&&e.state.manageUser&&e.FC_BlockUser(e.state.manageUser.user_id,e.state.manageUser.is_active)},disabled:this.state.loadingRequest,children:[Object(L.jsx)(m.ab,{className:"w-4 h-4 fill-current"}),Object(L.jsx)("span",{children:this.state.loadingRequestType&&"RESET"===this.state.loadingRequestType?"Loading...":"Re-Activate"})]})]})]},this.state.manageUser.user_id+Math.random())]}),this.state.changeRole?Object(L.jsx)(N.a,{userInfo:this.state.manageUser,roleList:this.props.accessRoles,district:t,roomList:this.state.roomList,setRoomList:this.setRoomList,setRoomTables:this.setRoomTables,setChangeRole:this.setChangeRole,currentPage:1}):Object(L.jsx)(w.UserAccess,{userInfo:this.state.manageUser,manageUserId:this.state.manageUserId,setUserAccess:this.setUserAccess,userAccess:this.state.userAccess,setCurrentAccess:this.setCurrentAccess,currentAccess:this.state.currentAccess,currentPage:1})]}):Object(L.jsx)("div",{className:"w-full",children:Object(L.jsx)(A.b,{theme:A.a.Dark,value:"User info not found"})})]})]})}}]),s}(u.Component),T=Object(g.b)((function(e){var t=e.auth,s=e.access,a=e.schoolLevels;return{auth:t,accessRoles:s.accessRoles,schoolLevels:a}}),{FC_GetAccessRoles:p.R,loadEducationCategories:p.Jc,PushPopupAlert:p.Rb})(q)}}]);
//# sourceMappingURL=71.b23dbdec.chunk.js.map